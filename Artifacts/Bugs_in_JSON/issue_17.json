{
  "url": "https://api.github.com/repos/tensorflow/tensorflow/issues/31324",
  "repository_url": "https://api.github.com/repos/tensorflow/tensorflow",
  "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/31324/labels{/name}",
  "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/31324/comments",
  "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/31324/events",
  "html_url": "https://github.com/tensorflow/tensorflow/issues/31324",
  "id": 476584541,
  "node_id": "MDU6SXNzdWU0NzY1ODQ1NDE=",
  "number": 31324,
  "title": "Passing a Variable as learning_rate to Adam optimizer does not work as expected",
  "user": {
    "login": "bjornsing",
    "id": 3122051,
    "node_id": "MDQ6VXNlcjMxMjIwNTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3122051?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bjornsing",
    "html_url": "https://github.com/bjornsing",
    "followers_url": "https://api.github.com/users/bjornsing/followers",
    "following_url": "https://api.github.com/users/bjornsing/following{/other_user}",
    "gists_url": "https://api.github.com/users/bjornsing/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bjornsing/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bjornsing/subscriptions",
    "organizations_url": "https://api.github.com/users/bjornsing/orgs",
    "repos_url": "https://api.github.com/users/bjornsing/repos",
    "events_url": "https://api.github.com/users/bjornsing/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bjornsing/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 284443156,
      "node_id": "MDU6TGFiZWwyODQ0NDMxNTY=",
      "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:docs-bug",
      "name": "type:docs-bug",
      "color": "159b2e",
      "default": false,
      "description": "Document issues"
    },
    {
      "id": 473172988,
      "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=",
      "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug",
      "name": "type:bug",
      "color": "159b2e",
      "default": false,
      "description": "Bug"
    },
    {
      "id": 1097546578,
      "node_id": "MDU6TGFiZWwxMDk3NTQ2NTc4",
      "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:keras",
      "name": "comp:keras",
      "color": "0052cc",
      "default": false,
      "description": "Keras related issues"
    },
    {
      "id": 1160540362,
      "node_id": "MDU6TGFiZWwxMTYwNTQwMzYy",
      "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/TF%202.0",
      "name": "TF 2.0",
      "color": "e79b38",
      "default": false,
      "description": "Issues relating to TensorFlow 2.0"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "MarkDaoust",
    "id": 1414837,
    "node_id": "MDQ6VXNlcjE0MTQ4Mzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1414837?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MarkDaoust",
    "html_url": "https://github.com/MarkDaoust",
    "followers_url": "https://api.github.com/users/MarkDaoust/followers",
    "following_url": "https://api.github.com/users/MarkDaoust/following{/other_user}",
    "gists_url": "https://api.github.com/users/MarkDaoust/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MarkDaoust/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MarkDaoust/subscriptions",
    "organizations_url": "https://api.github.com/users/MarkDaoust/orgs",
    "repos_url": "https://api.github.com/users/MarkDaoust/repos",
    "events_url": "https://api.github.com/users/MarkDaoust/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MarkDaoust/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "MarkDaoust",
      "id": 1414837,
      "node_id": "MDQ6VXNlcjE0MTQ4Mzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1414837?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarkDaoust",
      "html_url": "https://github.com/MarkDaoust",
      "followers_url": "https://api.github.com/users/MarkDaoust/followers",
      "following_url": "https://api.github.com/users/MarkDaoust/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarkDaoust/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarkDaoust/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarkDaoust/subscriptions",
      "organizations_url": "https://api.github.com/users/MarkDaoust/orgs",
      "repos_url": "https://api.github.com/users/MarkDaoust/repos",
      "events_url": "https://api.github.com/users/MarkDaoust/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarkDaoust/received_events",
      "type": "User",
      "site_admin": false
    },
    {
      "login": "tanzhenyu",
      "id": 15220929,
      "node_id": "MDQ6VXNlcjE1MjIwOTI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15220929?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tanzhenyu",
      "html_url": "https://github.com/tanzhenyu",
      "followers_url": "https://api.github.com/users/tanzhenyu/followers",
      "following_url": "https://api.github.com/users/tanzhenyu/following{/other_user}",
      "gists_url": "https://api.github.com/users/tanzhenyu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tanzhenyu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tanzhenyu/subscriptions",
      "organizations_url": "https://api.github.com/users/tanzhenyu/orgs",
      "repos_url": "https://api.github.com/users/tanzhenyu/repos",
      "events_url": "https://api.github.com/users/tanzhenyu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tanzhenyu/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2019-08-04T19:15:01Z",
  "updated_at": "2020-04-29T23:12:11Z",
  "closed_at": "2019-10-01T23:16:04Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "tag:bug_template\r\n\r\n**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow): Yes\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Ubuntu 18.04\r\n- Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device: n/a\r\n- TensorFlow installed from (source or binary): binary through pip3\r\n- TensorFlow version (use command below): v2.0.0-beta0-16-g1d91213fe7 2.0.0-beta1\r\n- Python version: sys.version_info(major=3, minor=5, micro=6, releaselevel='final', serial=0)\r\n- Bazel version (if compiling from source): n/a\r\n- GCC/Compiler version (if compiling from source): n/a\r\n- CUDA/cuDNN version: 10.0.130_410.48 / 10.0-linux-x64-v7.4.2.24\r\n- GPU model and memory: GeForce GTX 1080 with 7598 MB memory\r\n\r\n**Describe the current behavior**\r\n\r\nIf a tf.Variable is passed as learning_rate to the Adam optimizer, and the variable is later changed that does not seem to affect the optimizer. Instead, the optimizer seems to \"cache\" the value of the variable at the time when the optimizer was constructed.\r\n\r\n**Describe the expected behavior**\r\n\r\nMy expectation was that if I pass a tf.Variable as the learning_rate argument to tf.keras.optimizers.Adam(), and later assign a new value to the variable, that would affect the optimization.\r\n\r\n**Code to reproduce the issue**\r\nProvide a reproducible test case that is the bare minimum necessary to generate the problem.\r\n\r\n```\r\nimport tensorflow as tf\r\nprint(tf.version.GIT_VERSION, tf.version.VERSION)\r\n\r\nimport sys\r\nprint(sys.version_info)\r\n\r\ntf_a = tf.Variable(1.0)\r\nprint('Variable tf_a initialized to {}.'.format(tf_a.numpy()))\r\n\r\ntf_lr = tf.Variable(0.1, trainable=False)\r\n\r\ntf_opt = tf.keras.optimizers.Adam(learning_rate=tf_lr)\r\n\r\n@tf.function\r\ndef train_step():\r\n    with tf.GradientTape() as tf_tape:\r\n        tf_loss = tf_a**2\r\n        \r\n    tf_gradients = tf_tape.gradient(tf_loss, [tf_a])\r\n\r\n    tf_opt.apply_gradients(zip(tf_gradients, [tf_a]))\r\n\r\nprint('After one step with learning rate {}... '.format(tf_lr.numpy()), end='')\r\ntrain_step()\r\nprint('Variable tf_a is {}.'.format(tf_a.numpy()))\r\n\r\ntf_lr.assign(0.0)\r\n\r\nfor _ in range(10):\r\n    print('After another step, now with learning rate {}... '.format(tf_lr.numpy()), end='')\r\n    train_step()\r\n    print('Variable tf_a is {}.'.format(tf_a.numpy()))\r\n```\r\n\r\nThe code above produces the following output on my system:\r\n\r\n```\r\nv2.0.0-beta0-16-g1d91213fe7 2.0.0-beta1\r\nsys.version_info(major=3, minor=5, micro=6, releaselevel='final', serial=0)\r\nVariable tf_a initialized to 1.0.\r\nAfter one step with learning rate 0.10000000149011612... Variable tf_a is 0.8999971747398376.\r\nAfter another step, now with learning rate 0.0... Variable tf_a is 0.8004083633422852.\r\nAfter another step, now with learning rate 0.0... Variable tf_a is 0.7015821933746338.\r\nAfter another step, now with learning rate 0.0... Variable tf_a is 0.6039347052574158.\r\nAfter another step, now with learning rate 0.0... Variable tf_a is 0.5079591274261475.\r\nAfter another step, now with learning rate 0.0... Variable tf_a is 0.41423195600509644.\r\nAfter another step, now with learning rate 0.0... Variable tf_a is 0.3234161138534546.\r\nAfter another step, now with learning rate 0.0... Variable tf_a is 0.23625943064689636.\r\nAfter another step, now with learning rate 0.0... Variable tf_a is 0.1535806804895401.\r\nAfter another step, now with learning rate 0.0... Variable tf_a is 0.07624538242816925.\r\nAfter another step, now with learning rate 0.0... Variable tf_a is 0.005127914249897003.\r\n```\r\nAs you can see tf_a keeps changing at a fast pace. My expectation was that after setting the learning rate variable to 0.0 updates would no-longer change tf_a.\r\n\r\n**Other info / logs**\r\nInclude any logs or source code that would be helpful to diagnose the problem. If including tracebacks, please include the full traceback. Large logs and files should be attached.\r\n",
  "closed_by": {
    "login": "jvishnuvardhan",
    "id": 46058173,
    "node_id": "MDQ6VXNlcjQ2MDU4MTcz",
    "avatar_url": "https://avatars.githubusercontent.com/u/46058173?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jvishnuvardhan",
    "html_url": "https://github.com/jvishnuvardhan",
    "followers_url": "https://api.github.com/users/jvishnuvardhan/followers",
    "following_url": "https://api.github.com/users/jvishnuvardhan/following{/other_user}",
    "gists_url": "https://api.github.com/users/jvishnuvardhan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jvishnuvardhan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jvishnuvardhan/subscriptions",
    "organizations_url": "https://api.github.com/users/jvishnuvardhan/orgs",
    "repos_url": "https://api.github.com/users/jvishnuvardhan/repos",
    "events_url": "https://api.github.com/users/jvishnuvardhan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jvishnuvardhan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/tensorflow/tensorflow/issues/31324/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/31324/timeline",
  "performed_via_github_app": null
}
