{
  "url": "https://api.github.com/repos/tensorflow/tensorflow/issues/42890",
  "repository_url": "https://api.github.com/repos/tensorflow/tensorflow",
  "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/42890/labels{/name}",
  "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/42890/comments",
  "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/42890/events",
  "html_url": "https://github.com/tensorflow/tensorflow/issues/42890",
  "id": 690889544,
  "node_id": "MDU6SXNzdWU2OTA4ODk1NDQ=",
  "number": 42890,
  "title": "load_model not properly working in TF 2.3.0",
  "user": {
    "login": "HaraBeron",
    "id": 68148852,
    "node_id": "MDQ6VXNlcjY4MTQ4ODUy",
    "avatar_url": "https://avatars.githubusercontent.com/u/68148852?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/HaraBeron",
    "html_url": "https://github.com/HaraBeron",
    "followers_url": "https://api.github.com/users/HaraBeron/followers",
    "following_url": "https://api.github.com/users/HaraBeron/following{/other_user}",
    "gists_url": "https://api.github.com/users/HaraBeron/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/HaraBeron/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/HaraBeron/subscriptions",
    "organizations_url": "https://api.github.com/users/HaraBeron/orgs",
    "repos_url": "https://api.github.com/users/HaraBeron/repos",
    "events_url": "https://api.github.com/users/HaraBeron/events{/privacy}",
    "received_events_url": "https://api.github.com/users/HaraBeron/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 386191887,
      "node_id": "MDU6TGFiZWwzODYxOTE4ODc=",
      "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20response",
      "name": "stat:awaiting response",
      "color": "f4b400",
      "default": false,
      "description": "Status  - Awaiting response from author"
    },
    {
      "id": 473172988,
      "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=",
      "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug",
      "name": "type:bug",
      "color": "159b2e",
      "default": false,
      "description": "Bug"
    },
    {
      "id": 1097546578,
      "node_id": "MDU6TGFiZWwxMDk3NTQ2NTc4",
      "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:keras",
      "name": "comp:keras",
      "color": "0052cc",
      "default": false,
      "description": "Keras related issues"
    },
    {
      "id": 1946362326,
      "node_id": "MDU6TGFiZWwxOTQ2MzYyMzI2",
      "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/TF%202.3",
      "name": "TF 2.3",
      "color": "1d76db",
      "default": false,
      "description": "Issues related to TF 2.3"
    },
    {
      "id": 2046763290,
      "node_id": "MDU6TGFiZWwyMDQ2NzYzMjkw",
      "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/Fixed%20in%20Nightly",
      "name": "Fixed in Nightly",
      "color": "5ecc37",
      "default": false,
      "description": "Issues that are resolved in nightly version"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "jvishnuvardhan",
    "id": 46058173,
    "node_id": "MDQ6VXNlcjQ2MDU4MTcz",
    "avatar_url": "https://avatars.githubusercontent.com/u/46058173?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jvishnuvardhan",
    "html_url": "https://github.com/jvishnuvardhan",
    "followers_url": "https://api.github.com/users/jvishnuvardhan/followers",
    "following_url": "https://api.github.com/users/jvishnuvardhan/following{/other_user}",
    "gists_url": "https://api.github.com/users/jvishnuvardhan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jvishnuvardhan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jvishnuvardhan/subscriptions",
    "organizations_url": "https://api.github.com/users/jvishnuvardhan/orgs",
    "repos_url": "https://api.github.com/users/jvishnuvardhan/repos",
    "events_url": "https://api.github.com/users/jvishnuvardhan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jvishnuvardhan/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "jvishnuvardhan",
      "id": 46058173,
      "node_id": "MDQ6VXNlcjQ2MDU4MTcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/46058173?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jvishnuvardhan",
      "html_url": "https://github.com/jvishnuvardhan",
      "followers_url": "https://api.github.com/users/jvishnuvardhan/followers",
      "following_url": "https://api.github.com/users/jvishnuvardhan/following{/other_user}",
      "gists_url": "https://api.github.com/users/jvishnuvardhan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jvishnuvardhan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jvishnuvardhan/subscriptions",
      "organizations_url": "https://api.github.com/users/jvishnuvardhan/orgs",
      "repos_url": "https://api.github.com/users/jvishnuvardhan/repos",
      "events_url": "https://api.github.com/users/jvishnuvardhan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jvishnuvardhan/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2020-09-02T10:02:28Z",
  "updated_at": "2020-09-03T21:40:28Z",
  "closed_at": "2020-09-03T21:40:26Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow): Custom Code\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04): Windows\r\n- TensorFlow installed from (source or binary): Colab TF 2.3.0 vs TF 2.2.0\r\n- TensorFlow version (use command below): Colab TF 2.3.0 vs TF 2.2.0\r\n- Python version: Colab Python\r\n- GPU model and memory: Colab GPU\r\n\r\nWhen I used TF 2.2.0 in colab I was able to fit, save and load a model. So I run my code, fit my model:\r\n![grafik](https://user-images.githubusercontent.com/68148852/91966779-9bf5e880-ed12-11ea-8ec3-7e499a5024eb.png)\r\n\r\n and check again with model.evaluate:\r\n![grafik](https://user-images.githubusercontent.com/68148852/91966830-ac0dc800-ed12-11ea-9ab8-68c2b84cb218.png)\r\n\r\nEverything as expected. Then I save the model and load it back again and I check it again with model.evaluate and same accuracy is shown. Everything fine. However, the same code does not work in TF 2.3.0. See my code below. If this code is run by default TF 2.3.0 is used in colab and it does not work. The accuracy of the loaded model loadedmodel.evaluate(x_test_r,test_labels) is not the same:\r\n\r\n![grafik](https://user-images.githubusercontent.com/68148852/91966880-c051c500-ed12-11ea-9b72-3c57fffc5646.png)\r\n\r\nIt is completely wrong (approx .098... vs supposed 0.99... when I run it). When I add !pip install tensorflow==2.2.0 to my code and run the same code in my colab again (note that the runtime has to be restarted) then with the 2.2.0 version it does work.\r\n\r\n(When I save the model in TF 2.2.0 (where evaluate works and correct accuracy is shown) and then load it in TF 2.3.0, it does not work. model.evaluate shows a wrong accuracy.)\r\n\r\n**Standalone code to reproduce the issue**\r\n```\r\n#!pip install tensorflow==2.2.0\r\nimport tensorflow as tf\r\nimport os\r\nimport PIL\r\nimport numpy as np\r\nimport matplotlib.pyplot as plt\r\nimport tensorflow_datasets as tfds\r\nimport tensorflow_hub as hub\r\n\r\nfrom tensorflow.keras.models import Sequential\r\n\r\nfrom tensorflow.keras.layers import Dense, Conv2D, Flatten, Dropout, MaxPooling2D\r\nfrom tensorflow.keras.preprocessing.image import ImageDataGenerator\r\n\r\nimport keras_preprocessing\r\nfrom keras_preprocessing import image\r\n\r\nfrom tensorflow.python.keras.utils.version_utils import training\r\nfrom tensorflow.keras.optimizers import RMSprop\r\n\r\nprint(tf.__version__)\r\n\r\n(train_images, train_labels), (test_images, test_labels) = tf.keras.datasets.mnist.load_data()\r\n\r\nx_trainf = train_images.astype('float32') / 255.0\r\nx_testf = test_images.astype('float32') / 255.0\r\n\r\nx_train_r = x_trainf.reshape(x_trainf.shape[0], 28, 28, 1)\r\nx_test_r = x_testf.reshape(x_testf.shape[0], 28, 28, 1)\r\n\r\nmodel = tf.keras.Sequential()\r\nmodel.add(tf.keras.layers.Conv2D(filters=64, kernel_size=3, padding='same', activation='relu', input_shape=(28,28,1))) \r\nmodel.add(tf.keras.layers.MaxPooling2D(pool_size=2))\r\nmodel.add(tf.keras.layers.Dropout(0.2))\r\nmodel.add(tf.keras.layers.Conv2D(filters=32, kernel_size=2, padding='same', activation='relu'))\r\nmodel.add(tf.keras.layers.MaxPooling2D(pool_size=2))\r\nmodel.add(tf.keras.layers.Dropout(0.2))\r\nmodel.add(tf.keras.layers.Flatten())\r\nmodel.add(tf.keras.layers.Dense(256, activation='relu'))\r\nmodel.add(tf.keras.layers.Dropout(0.2))\r\nmodel.add(tf.keras.layers.Dense(10))\r\n\r\nmodel.compile(optimizer='adam',\r\n              loss=tf.losses.SparseCategoricalCrossentropy(from_logits=True),\r\n              metrics=['accuracy'])\r\n\r\nmodel.fit(x_train_r, \r\n          train_labels, batch_size=32,  \r\n          epochs=10,\r\n          validation_data=(x_test_r,test_labels))\r\n\r\nmodel.evaluate(x_test_r,test_labels)\r\n\r\nmodel.save('/tmp/loaddatamnist.h5')\r\n\r\nloadedmodel=tf.keras.models.load_model('/tmp/loaddatamnist.h5')\r\nloadedmodel.evaluate(x_test_r,test_labels)\r\n```\r\n\r\n\r\n",
  "closed_by": {
    "login": "jvishnuvardhan",
    "id": 46058173,
    "node_id": "MDQ6VXNlcjQ2MDU4MTcz",
    "avatar_url": "https://avatars.githubusercontent.com/u/46058173?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jvishnuvardhan",
    "html_url": "https://github.com/jvishnuvardhan",
    "followers_url": "https://api.github.com/users/jvishnuvardhan/followers",
    "following_url": "https://api.github.com/users/jvishnuvardhan/following{/other_user}",
    "gists_url": "https://api.github.com/users/jvishnuvardhan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jvishnuvardhan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jvishnuvardhan/subscriptions",
    "organizations_url": "https://api.github.com/users/jvishnuvardhan/orgs",
    "repos_url": "https://api.github.com/users/jvishnuvardhan/repos",
    "events_url": "https://api.github.com/users/jvishnuvardhan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jvishnuvardhan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/tensorflow/tensorflow/issues/42890/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/42890/timeline",
  "performed_via_github_app": null
}
