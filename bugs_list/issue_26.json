{
  "url": "https://api.github.com/repos/tensorflow/tensorflow/issues/44092",
  "repository_url": "https://api.github.com/repos/tensorflow/tensorflow",
  "labels_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/44092/labels{/name}",
  "comments_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/44092/comments",
  "events_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/44092/events",
  "html_url": "https://github.com/tensorflow/tensorflow/issues/44092",
  "id": 723344929,
  "node_id": "MDU6SXNzdWU3MjMzNDQ5Mjk=",
  "number": 44092,
  "title": "Loss of shape information when using dilation_rate != 1 in Conv layers",
  "user": {
    "login": "HarryAA",
    "id": 15262274,
    "node_id": "MDQ6VXNlcjE1MjYyMjc0",
    "avatar_url": "https://avatars.githubusercontent.com/u/15262274?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/HarryAA",
    "html_url": "https://github.com/HarryAA",
    "followers_url": "https://api.github.com/users/HarryAA/followers",
    "following_url": "https://api.github.com/users/HarryAA/following{/other_user}",
    "gists_url": "https://api.github.com/users/HarryAA/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/HarryAA/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/HarryAA/subscriptions",
    "organizations_url": "https://api.github.com/users/HarryAA/orgs",
    "repos_url": "https://api.github.com/users/HarryAA/repos",
    "events_url": "https://api.github.com/users/HarryAA/events{/privacy}",
    "received_events_url": "https://api.github.com/users/HarryAA/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 404586594,
      "node_id": "MDU6TGFiZWw0MDQ1ODY1OTQ=",
      "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/stat:awaiting%20tensorflower",
      "name": "stat:awaiting tensorflower",
      "color": "f4b400",
      "default": false,
      "description": "Status  - Awaiting response from tensorflower"
    },
    {
      "id": 473172988,
      "node_id": "MDU6TGFiZWw0NzMxNzI5ODg=",
      "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/type:bug",
      "name": "type:bug",
      "color": "159b2e",
      "default": false,
      "description": "Bug"
    },
    {
      "id": 1097546578,
      "node_id": "MDU6TGFiZWwxMDk3NTQ2NTc4",
      "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/comp:keras",
      "name": "comp:keras",
      "color": "0052cc",
      "default": false,
      "description": "Keras related issues"
    },
    {
      "id": 1946362326,
      "node_id": "MDU6TGFiZWwxOTQ2MzYyMzI2",
      "url": "https://api.github.com/repos/tensorflow/tensorflow/labels/TF%202.3",
      "name": "TF 2.3",
      "color": "1d76db",
      "default": false,
      "description": "Issues related to TF 2.3"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "jvishnuvardhan",
    "id": 46058173,
    "node_id": "MDQ6VXNlcjQ2MDU4MTcz",
    "avatar_url": "https://avatars.githubusercontent.com/u/46058173?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jvishnuvardhan",
    "html_url": "https://github.com/jvishnuvardhan",
    "followers_url": "https://api.github.com/users/jvishnuvardhan/followers",
    "following_url": "https://api.github.com/users/jvishnuvardhan/following{/other_user}",
    "gists_url": "https://api.github.com/users/jvishnuvardhan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jvishnuvardhan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jvishnuvardhan/subscriptions",
    "organizations_url": "https://api.github.com/users/jvishnuvardhan/orgs",
    "repos_url": "https://api.github.com/users/jvishnuvardhan/repos",
    "events_url": "https://api.github.com/users/jvishnuvardhan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jvishnuvardhan/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "jvishnuvardhan",
      "id": 46058173,
      "node_id": "MDQ6VXNlcjQ2MDU4MTcz",
      "avatar_url": "https://avatars.githubusercontent.com/u/46058173?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jvishnuvardhan",
      "html_url": "https://github.com/jvishnuvardhan",
      "followers_url": "https://api.github.com/users/jvishnuvardhan/followers",
      "following_url": "https://api.github.com/users/jvishnuvardhan/following{/other_user}",
      "gists_url": "https://api.github.com/users/jvishnuvardhan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jvishnuvardhan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jvishnuvardhan/subscriptions",
      "organizations_url": "https://api.github.com/users/jvishnuvardhan/orgs",
      "repos_url": "https://api.github.com/users/jvishnuvardhan/repos",
      "events_url": "https://api.github.com/users/jvishnuvardhan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jvishnuvardhan/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-10-16T16:01:07Z",
  "updated_at": "2021-01-08T19:22:07Z",
  "closed_at": "2021-01-08T19:22:05Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<em>Please make sure that this is a bug. As per our\r\n[GitHub Policy](https://github.com/tensorflow/tensorflow/blob/master/ISSUES.md),\r\nwe only address code/doc bugs, performance issues, feature requests and\r\nbuild/installation issues on GitHub. tag:bug_template</em>\r\n\r\n**System information**\r\n- Have I written custom code (as opposed to using a stock example script provided in TensorFlow):\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04):\r\n- Mobile device (e.g. iPhone 8, Pixel 2, Samsung Galaxy) if the issue happens on mobile device:\r\n- TensorFlow installed from (source or binary):\r\n- TensorFlow version (use command below):\r\n- Python version:\r\n- Bazel version (if compiling from source):\r\n- GCC/Compiler version (if compiling from source):\r\n- CUDA/cuDNN version:\r\n- GPU model and memory:\r\n\r\nYou can collect some of this information using our environment capture\r\n[script](https://github.com/tensorflow/tensorflow/tree/master/tools/tf_env_collect.sh)\r\nYou can also obtain the TensorFlow version with:\r\n1. TF 1.0: `python -c \"import tensorflow as tf; print(tf.GIT_VERSION, tf.VERSION)\"`\r\n2. TF 2.0: `python -c \"import tensorflow as tf; print(tf.version.GIT_VERSION, tf.version.VERSION)\"`\r\n\r\n\r\n**Describe the current behavior**\r\nRunning TF 2.3.0 in colab I have come across an issue very similar to the one fixed in #29542 . The difference however being that I have an extra dimension that is undefined at layer construction time. With a dilation rate = 1 the Conv2D layer in the following code produces an output shape as expected (None, None, 512, 64). However, for layers with a dilation rate > 1, the \"width\" dimension shape information is lost and the result is (None, None, None, 64).\r\n\r\n```\r\nimport tensorflow as tf\r\n\r\nclass DenseBlock(tf.keras.Model):\r\n  def __init__(self, input_size, depth=5, in_channels=64):\r\n    super(DenseBlock, self).__init__(name='')\r\n    self.depth = depth\r\n    self.in_channels = in_channels\r\n    self.pad = tf.keras.layers.ZeroPadding2D(((1, 0), (1, 1)))\r\n    self.twidth = 2\r\n    self.kernel_size = (self.twidth, 3)\r\n    for i in range(self.depth):\r\n      dil = 2**i\r\n      pad_length = self.twidth + (dil-1)*(self.twidth-1)-1\r\n      setattr(self, 'pad{}'.format(i+1), tf.keras.layers.ZeroPadding2D(((pad_length, 0), (1, 1))))\r\n      setattr(self, 'conv{}'.format(i+1), tf.keras.layers.Conv2D(filters=self.in_channels, kernel_size=self.kernel_size, dilation_rate=(dil, 1)))\r\n      setattr(self, 'norm{}'.format(i+1), tf.keras.layers.LayerNormalization())\r\n      setattr(self, 'prelu{}'.format(i+1), tf.keras.layers.PReLU(shared_axes=[1, 2]))\r\n\r\n  def call(self, input_tensor):\r\n    skip = input_tensor\r\n    for i in range(self.depth):\r\n      print('Dilation rate', 2**i)\r\n      x = getattr(self, 'pad{}'.format(i+1))(skip)\r\n      print(x.shape)\r\n      x = getattr(self, 'conv{}'.format(i+1))(x)\r\n      print(x.shape)\r\n      x = getattr(self, 'norm{}'.format(i+1))(x)\r\n      x = getattr(self, 'prelu{}'.format(i+1))(x)\r\n      skip = tf.concat((x, skip), axis=3)\r\n    return x\r\n\r\ninput = tf.keras.layers.Input(shape=(None, 512, 64))\r\nx = DenseBlock(512, 5, 64)(input)\r\n```\r\n\r\n**Describe the expected behavior**\r\nI believe that the behaviour for dilation rate > 1 should match that of the case where dilation rate = 1.\r\n\r\n**Standalone code to reproduce the issue**\r\nHere is a [link](https://colab.research.google.com/drive/11wATlQbeahUHQE63RFsMFl6EV598j1sm?usp=sharing) to a colab notebook that reproduces the issue \r\n\r\n**Other info / logs** Include any logs or source code that would be helpful to\r\ndiagnose the problem. If including tracebacks, please include the full\r\ntraceback. Large logs and files should be attached.\r\n\r\nThe cell output is:\r\n```\r\n2.3.0\r\nDilation rate 1\r\n(None, None, 514, 64)\r\n(None, None, 512, 64)\r\nDilation rate 2\r\n(None, None, 514, 128)\r\n(None, None, None, 64)\r\nDilation rate 4\r\n(None, None, 514, 192)\r\n(None, None, None, 64)\r\nDilation rate 8\r\n(None, None, 514, 256)\r\n(None, None, None, 64)\r\nDilation rate 16\r\n(None, None, 514, 320)\r\n(None, None, None, 64)\r\n```\r\n",
  "closed_by": {
    "login": "copybara-service[bot]",
    "id": 56741989,
    "node_id": "MDM6Qm90NTY3NDE5ODk=",
    "avatar_url": "https://avatars.githubusercontent.com/in/44061?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/copybara-service%5Bbot%5D",
    "html_url": "https://github.com/apps/copybara-service",
    "followers_url": "https://api.github.com/users/copybara-service%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/copybara-service%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/copybara-service%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/copybara-service%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/tensorflow/tensorflow/issues/44092/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/tensorflow/tensorflow/issues/44092/timeline",
  "performed_via_github_app": null
}
